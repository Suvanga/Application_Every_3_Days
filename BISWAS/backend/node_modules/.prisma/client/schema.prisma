// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id         String      @id @default(uuid())
  auth0_id   String      @unique
  email      String
  created_at DateTime    @default(now())
  goals      Goal[]
  insights   AIInsight[]

  @@map("users") // Maps to table name "users" in DB
}

model Goal {
  id           String    @id @default(uuid())
  user_id      String
  user         User      @relation(fields: [user_id], references: [id])
  title        String
  target_value Int
  deadline     DateTime?
  status       String    @default("active")
  habits       Habit[]

  @@map("goals")
}

model Habit {
  id           String     @id @default(uuid())
  goal_id      String
  goal         Goal       @relation(fields: [goal_id], references: [id])
  name         String
  type         String // 'growth' or 'maintenance'
  impact_score Int        @default(1)
  frequency    String     @default("daily")
  created_at   DateTime   @default(now())
  logs         HabitLog[]

  @@map("habits")
}

model HabitLog {
  id              String   @id @default(uuid())
  habit_id        String
  habit           Habit    @relation(fields: [habit_id], references: [id])
  completed_at    DateTime @default(now())
  status          Boolean  @default(false)
  friction_rating Int?
  friction_note   String?
  date            DateTime @db.Date

  @@map("habit_logs")
}

model AIInsight {
  id           String   @id @default(uuid())
  user_id      String
  user         User     @relation(fields: [user_id], references: [id])
  insight_text String
  generated_at DateTime @default(now())
  context_tags String[]

  @@map("ai_insights")
}
